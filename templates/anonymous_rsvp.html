{% extends "base.html" %}

{% block content %}
<div class="event-card anonymous-rsvp-card">
    {% if header_image %}
    <img src="/static/images/{{ header_image }}" class="header-image" alt="Invitation header">
    {% endif %}
    <h2>{{ title }}</h2>
    <p class="description">{{ description }}</p>
    
    <div class="anonymous-rsvp-form">
        <h3>Please RSVP</h3>
        <p>We'd love to have you! Please let us know if you can make it.</p>
        
        {% if error %}
        <div class="error">{{ error }}</div>
        {% endif %}
        
        <form method="POST" action="/anonymous-rsvp/{{ event_id }}">
            <div class="form-group">
                <label for="guest_name">Your Name:</label>
                <input type="text" id="guest_name" name="guest_name" required value="{{ guest_name or '' }}">
            </div>
            
            <div class="form-group">
                <label for="guest_phone">Your Phone Number:</label>
                <input type="tel" id="guest_phone" name="guest_phone" required 
                       placeholder="(555) 123-4567" value="{{ guest_phone or '' }}">
                <small>Used to prevent duplicates. Use same number to update your RSVP.</small>
            </div>
            
            <div class="form-group">
                <label for="guest_email">Your Email (optional):</label>
                <input type="email" id="guest_email" name="guest_email" 
                       placeholder="For updates about the event" value="{{ guest_email or '' }}">
            </div>
            
            <div class="rsvp-options">
                <h4>Will you attend?</h4>
                <div class="rsvp-choice">
                    <input type="radio" id="rsvp_yes" name="rsvp" value="yes" required>
                    <label for="rsvp_yes">Yes, I'll be there! ðŸŽ‰</label>
                </div>
                <div class="rsvp-choice">
                    <input type="radio" id="rsvp_no" name="rsvp" value="no" required>
                    <label for="rsvp_no">Sorry, can't make it</label>
                </div>
            </div>
            
            <div class="quantity-section" id="quantity_section" style="display: none;">
                <h4>How many people?</h4>
                <div class="quantity-inputs">
                    <div class="quantity-group">
                        <label for="adults_qty">Adults:</label>
                        <input type="number" id="adults_qty" name="adults_qty" min="1" max="10" value="1">
                    </div>
                    <div class="quantity-group">
                        <label for="kids_qty">Kids:</label>
                        <input type="number" id="kids_qty" name="kids_qty" min="0" max="10" value="0">
                    </div>
                </div>
                
                <div class="dietary-section">
                    <h4>Dietary Restrictions & Allergies</h4>
                    <p class="dietary-help">Please let us know about any dietary restrictions, food allergies, or special accommodations needed.</p>
                    <textarea id="dietary_restrictions" name="dietary_restrictions" 
                              placeholder="e.g., Vegetarian, Gluten-free, Nut allergy, etc." 
                              rows="3" value="{{ dietary_restrictions or '' }}"></textarea>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary rsvp-submit">Submit RSVP</button>
        </form>
        
        <div class="event-details">
            <h4>Event Details</h4>
            <div class="detail-item">
                <span class="label">Hosted by:</span>
                <span class="value">{{ host }}</span>
            </div>
            <div class="detail-item">
                <span class="label">Date:</span>
                <span class="value">
                    <a href="#" class="date-link" onclick="toggleCalendarOptions(event)">{{ date_display }}<br>{{ time_display }}</a>
                    <div class="calendar-options-dropdown" id="calendar-options-anon" style="display: none;">
                        <a href="{{ calendar_links.google }}" target="_blank">Add to Google Calendar</a>
                        <a href="{{ calendar_links.outlook }}" target="_blank">Add to Outlook</a>
                        <a href="/calendar/{{ event_id }}" download="event_{{ event_id }}.ics">Download for iPhone/Android</a>
                    </div>
                </span>
            </div>
            <div class="detail-item">
                <span class="label">Location:</span>
                <span class="value">{{ location }}</span>
            </div>
            
            {% if registry1 or registry2 %}
            <div class="registry">
                <h4>Registry</h4>
                <img src="/static/images/registry.svg" alt="Registry" class="section-icon">
                <div class="registry-buttons">
                    {% if registry1 %}<a href="{{ registry1 }}" target="_blank" class="btn registry-btn">Babylist</a>{% endif %}
                    {% if registry2 %}<a href="{{ registry2 }}" target="_blank" class="btn registry-btn">Amazon</a>{% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const rsvpYes = document.getElementById('rsvp_yes');
    const rsvpNo = document.getElementById('rsvp_no');
    const quantitySection = document.getElementById('quantity_section');
    
    function toggleQuantitySection() {
        if (rsvpYes.checked) {
            quantitySection.style.display = 'block';
        } else {
            quantitySection.style.display = 'none';
        }
    }
    
    rsvpYes.addEventListener('change', toggleQuantitySection);
    rsvpNo.addEventListener('change', toggleQuantitySection);
});

function toggleCalendarOptions(event) {
    event.preventDefault();
    const dropdown = document.getElementById('calendar-options-anon');
    if (dropdown.style.display === 'none' || dropdown.style.display === '') {
        dropdown.style.display = 'block';
    } else {
        dropdown.style.display = 'none';
    }
}

// Close dropdown when clicking outside
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('calendar-options-anon');
    const dateLink = event.target.closest('.date-link');
    if (!dateLink && dropdown) {
        dropdown.style.display = 'none';
    }
});
</script>
{% endblock %}